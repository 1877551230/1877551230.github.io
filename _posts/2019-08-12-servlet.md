---
layout:     post
title:      Servlet
subtitle:   
date:       2019-08-12
categories: Java
author:     miracle
catalog: true
tags:
    - JavaWeb
---

* content
{:toc}


## web.xml:
web.xml文件存储在/webContent/WEB-INF/web.xml  
web.xml当前web项目的入口,即每一个web项目都要有一个web.xml文件  
web.xml在tomcat服务器启动的时候解析和加载,启动完毕后,改动了web.xml不会生效  
 解析:用dom4j能读取web.xml的内容  
 加载:解析完毕后把读取到的内容以字符串的方式存储到内存中  
 

## WEB-INF目录:
在webapp/WEB-INF目录
此目录中的所有资源,都不能通过浏览器来访问,但是程序可以访问,一些重要的页面可以放在里面

tomcat启动过程:
 1. Initialzation processed in xx ms-->启动时首先解析和加载tomcat目录中的web.xml-->tomcat自检
 2. starting service Catalina-->正在开启服务
 3. starting servlet engine-->开启服务中的servlet引擎,引擎开启后,自动读取/加载/解析部署后的web项目的web.xml-->项目的web.xml检查
 4. Server startup in xxx ms-->启动完毕

## servlet
sun公司做出一套servlet规范(接口),此套规范无法独立运行,必须放在web服务器中(tomcat)中运行,web服务器(tomcat),也可以称为web容器(放置多个web项目),有了这个前提可以做到通过浏览器请求一个url地址,最终执行了某个servlet中的doXXX方法,即通过浏览器就可以执行一段java代码,这就是设计servlet接口的目的  
**多个平台之间调用的时候,可以模拟servlet接口**  

### 提交方式:
1. post(表单):
以数据块的方式发送数据给服务端,可以发送大量数据,在地址栏不会显示内容,安全.
2. get(表单):
以数据字符串的方式发送给服务端,只能发送两百多字符,在地址栏上会显示数据内容,没有明确指定post提交,默认一律get提交

servlet运行的步骤:
1. 浏览器依据url建立与web服务器(tomcat)的连接
2. 浏览器对请求的数据打包并发送给服务器
3. 服务器解析请求的数据,并分别把数据封装到request对象和response对象
4. web应用服务器根据url的路径,寻找servlet并反射实例化servlet对象
5. web应用服务器调用init方法,做初始化
6. web应用服务器自动调用service方法,service方法根据method指定的值调用对应的doXXX方法
7. 执行doXXX方法,方法中通过response对象,把数据响应给浏览器
8. 浏览器获取到响应回来的数据(响应的实体内容),浏览器格式化显示数据到网页上

### servlet生命周期
web.xml部分代码:

```xml
<servlet>
  	<servlet-name>UserLoginServletName</servlet-name>
  	<servlet-class>cn.tedu.servlet.UserLoginServlet</servlet-class>
  	<!-- Object obj=Class.forName("cn.tedu.servlet.UserLoginServlet").newInstance(); -->
  </servlet>
  <servlet-mapping>
  	<servlet-name>UserLoginServletName</servlet-name>
  	<url-pattern>/login</url-pattern>
  </servlet-mapping>
```

浏览器请求某个url的时候,也就是在请求服务器中的servlet,如果web.xml中有此url,就寻找这个url的兄弟节点<servlet-name>,如果有,就取出名字,拿这个名字去整个web.xml文件中查找是否有<servlet><servlet-name><servlet-name/><servlet/>层级关系的servlet的名字,如果找到了就找<servlet-name>的兄弟节点<servet-class>,取出servlet-class的值,并反射实例化对象,此servlet生命周期开始,用此对象自动调用init方法(如果有),init方法只执行一次,并做相关的初始化工作;
然后自动调用service方法,service方法会根据method指定的值去调用对应的doXXX方法,只要服务器不停止,每次请求都会执行service方法,直到正常停止web应用服务器,会自动调用destroy方法,destroy方法用于销毁对象并释放内存空间,生命周期结束.

第一次请求servlet的时候生命周期开始
在服务器启动的时候生命周期开始
<servlet>
	<load-on-startup>数字<load-on-startup/>
</servlet>
load-on-startup:
此元素标记容器在启动的时候加载这个servlet,生命周期开始
它的值必须是一个整数,表示servlet加载的顺序,值>=0的时候表示容器在启动的时候加载,值<0或没有配置此项表示容器在该servlet被第一次请求的时候加载,整数值越小,优先级越高,servlet就越是优先加载
当值相同的时候,容器就按照书写的顺序加载
